#!/bin/sh
#----------------------------------------------------------------------------
#LicensedtotheApacheSoftwareFoundation(ASF)underone
#ormorecontributorlicenseagreements.SeetheNOTICEfile
#distributedwiththisworkforadditionalinformation
#regardingcopyrightownership.TheASFlicensesthisfile
#toyouundertheApacheLicense,Version2.0(the
#"License");youmaynotusethisfileexceptincompliance
#withtheLicense.YoumayobtainacopyoftheLicenseat
#
#http://www.apache.org/licenses/LICENSE-2.0
#
#Unlessrequiredbyapplicablelaworagreedtoinwriting,
#softwaredistributedundertheLicenseisdistributedonan
#"ASIS"BASIS,WITHOUTWARRANTIESORCONDITIONSOFANY
#KIND,eitherexpressorimplied.SeetheLicenseforthe
#specificlanguagegoverningpermissionsandlimitations
#undertheLicense.
#----------------------------------------------------------------------------

#----------------------------------------------------------------------------
#ApacheMavenWrapperstartupbatchscript,version3.3.4
#
#OptionalENVvars
#-----------------
#JAVA_HOME-locationofaJDKhomedir,requiredwhendownloadmavenviajavasource
#MVNW_REPOURL-repourlbasefordownloadingmavendistribution
#MVNW_USERNAME/MVNW_PASSWORD-userandpasswordfordownloadingmaven
#MVNW_VERBOSE-true:enableverboselog;debug:tracethemvnwscript;others:silencetheoutput
#----------------------------------------------------------------------------

set-euf
["${MVNW_VERBOSE-}"!=debug]||set-x

#OSspecificsupport.
native_path(){printf%s\\n"$1";}
case"$(uname)"in
CYGWIN*|MINGW*)
[-z"${JAVA_HOME-}"]||JAVA_HOME="$(cygpath--unix"$JAVA_HOME")"
native_path(){cygpath--path--windows"$1";}
;;
esac

#setJAVACMDandJAVACCMD
set_java_home(){
#ForCygwinandMinGW,ensurepathsareinUnixformatbeforeanythingistouched
if[-n"${JAVA_HOME-}"];then
if[-x"$JAVA_HOME/jre/sh/java"];then
#IBM'sJDKonAIXusesstrangelocationsfortheexecutables
JAVACMD="$JAVA_HOME/jre/sh/java"
JAVACCMD="$JAVA_HOME/jre/sh/javac"
else
JAVACMD="$JAVA_HOME/bin/java"
JAVACCMD="$JAVA_HOME/bin/javac"

if[!-x"$JAVACMD"]||[!-x"$JAVACCMD"];then
echo"TheJAVA_HOMEenvironmentvariableisnotdefinedcorrectly,somvnwcannotrun.">&2
echo"JAVA_HOMEissetto\"$JAVA_HOME\",but\"\$JAVA_HOME/bin/java\"or\"\$JAVA_HOME/bin/javac\"doesnotexist.">&2
return1
fi
fi
else
JAVACMD="$(
'set'+e
'unset'-fcommand2>/dev/null
'command'-vjava
)"||:
JAVACCMD="$(
'set'+e
'unset'-fcommand2>/dev/null
'command'-vjavac
)"||:

if[!-x"${JAVACMD-}"]||[!-x"${JAVACCMD-}"];then
echo"Thejava/javaccommanddoesnotexistinPATHnorisJAVA_HOMEset,somvnwcannotrun.">&2
return1
fi
fi
}

#hashstringlikeJavaString::hashCode
hash_string(){
str="${1:-}"h=0
while[-n"$str"];do
char="${str%"${str#?}"}"
h=$(((h*31+$(LC_CTYPE=Cprintf%d"'$char"))%4294967296))
str="${str#?}"
done
printf%x\\n$h
}

verbose(){:;}
["${MVNW_VERBOSE-}"!=true]||verbose(){printf%s\\n"${1-}";}

die(){
printf%s\\n"$1">&2
exit1
}

trim(){
#MWRAPPER-139:
#Trimstrailingandleadingwhitespace,carriagereturns,tabs,andlinefeeds.
#Neededforremovingpoorlyinterpretednewlinesequenceswhenrunninginmore
#exoticenvironmentssuchasmingwbashonWindows.
printf"%s""${1}"|tr-d'[:space:]'
}

scriptDir="$(dirname"$0")"
scriptName="$(basename"$0")"

#parsedistributionUrlandoptionaldistributionSha256Sum,requires.mvn/wrapper/maven-wrapper.properties
whileIFS="="read-rkeyvalue;do
case"${key-}"in
distributionUrl)distributionUrl=$(trim"${value-}");;
distributionSha256Sum)distributionSha256Sum=$(trim"${value-}");;
esac
done<"$scriptDir/.mvn/wrapper/maven-wrapper.properties"
[-n"${distributionUrl-}"]||die"cannotreaddistributionUrlpropertyin$scriptDir/.mvn/wrapper/maven-wrapper.properties"

case"${distributionUrl##*/}"in
maven-mvnd-*bin.*)
MVN_CMD=mvnd.sh_MVNW_REPO_PATTERN=/maven/mvnd/
case"${PROCESSOR_ARCHITECTURE-}${PROCESSOR_ARCHITEW6432-}:$(uname-a)"in
*AMD64:CYGWIN*|*AMD64:MINGW*)distributionPlatform=windows-amd64;;
:Darwin*x86_64)distributionPlatform=darwin-amd64;;
:Darwin*arm64)distributionPlatform=darwin-aarch64;;
:Linux*x86_64*)distributionPlatform=linux-amd64;;
*)
echo"Cannotdetectnativeplatformformvndon$(uname)-$(uname-m),usepurejavaversion">&2
distributionPlatform=linux-amd64
;;
esac
distributionUrl="${distributionUrl%-bin.*}-$distributionPlatform.zip"
;;
maven-mvnd-*)MVN_CMD=mvnd.sh_MVNW_REPO_PATTERN=/maven/mvnd/;;
*)MVN_CMD="mvn${scriptName#mvnw}"_MVNW_REPO_PATTERN=/org/apache/maven/;;
esac

#applyMVNW_REPOURLandcalculateMAVEN_HOME
#mavenhomepattern:~/.m2/wrapper/dists/{apache-maven-<version>,maven-mvnd-<version>-<platform>}/<hash>
[-z"${MVNW_REPOURL-}"]||distributionUrl="$MVNW_REPOURL$_MVNW_REPO_PATTERN${distributionUrl#*"$_MVNW_REPO_PATTERN"}"
distributionUrlName="${distributionUrl##*/}"
distributionUrlNameMain="${distributionUrlName%.*}"
distributionUrlNameMain="${distributionUrlNameMain%-bin}"
MAVEN_USER_HOME="${MAVEN_USER_HOME:-${HOME}/.m2}"
MAVEN_HOME="${MAVEN_USER_HOME}/wrapper/dists/${distributionUrlNameMain-}/$(hash_string"$distributionUrl")"

exec_maven(){
unsetMVNW_VERBOSEMVNW_USERNAMEMVNW_PASSWORDMVNW_REPOURL||:
exec"$MAVEN_HOME/bin/$MVN_CMD""$@"||die"cannotexec$MAVEN_HOME/bin/$MVN_CMD"
}

if[-d"$MAVEN_HOME"];then
verbose"foundexistingMAVEN_HOMEat$MAVEN_HOME"
exec_maven"$@"
fi

case"${distributionUrl-}"in
*?-bin.zip|*?maven-mvnd-?*-?*.zip);;
*)die"distributionUrlisnotvalid,mustmatch*-bin.zipormaven-mvnd-*.zip,butfound'${distributionUrl-}'";;
esac

#preparetmpdir
ifTMP_DOWNLOAD_DIR="$(mktemp-d)"&&[-d"$TMP_DOWNLOAD_DIR"];then
clean(){rm-rf--"$TMP_DOWNLOAD_DIR";}
trapcleanHUPINTTERMEXIT
else
die"cannotcreatetempdir"
fi

mkdir-p--"${MAVEN_HOME%/*}"

#DownloadandInstallApacheMaven
verbose"Couldn'tfindMAVEN_HOME,downloadingandinstallingit..."
verbose"Downloadingfrom:$distributionUrl"
verbose"Downloadingto:$TMP_DOWNLOAD_DIR/$distributionUrlName"

#select.zipor.tar.gz
if!command-vunzip>/dev/null;then
distributionUrl="${distributionUrl%.zip}.tar.gz"
distributionUrlName="${distributionUrl##*/}"
fi

#verboseopt
__MVNW_QUIET_WGET=--quiet__MVNW_QUIET_CURL=--silent__MVNW_QUIET_UNZIP=-q__MVNW_QUIET_TAR=''
["${MVNW_VERBOSE-}"!=true]||__MVNW_QUIET_WGET=''__MVNW_QUIET_CURL=''__MVNW_QUIET_UNZIP=''__MVNW_QUIET_TAR=v

#normalizehttpauth
case"${MVNW_PASSWORD:+has-password}"in
'')MVNW_USERNAME=''MVNW_PASSWORD='';;
has-password)[-n"${MVNW_USERNAME-}"]||MVNW_USERNAME=''MVNW_PASSWORD='';;
esac

if[-z"${MVNW_USERNAME-}"]&&command-vwget>/dev/null;then
verbose"Foundwget...usingwget"
wget${__MVNW_QUIET_WGET:+"$__MVNW_QUIET_WGET"}"$distributionUrl"-O"$TMP_DOWNLOAD_DIR/$distributionUrlName"||die"wget:Failedtofetch$distributionUrl"
elif[-z"${MVNW_USERNAME-}"]&&command-vcurl>/dev/null;then
verbose"Foundcurl...usingcurl"
curl${__MVNW_QUIET_CURL:+"$__MVNW_QUIET_CURL"}-f-L-o"$TMP_DOWNLOAD_DIR/$distributionUrlName""$distributionUrl"||die"curl:Failedtofetch$distributionUrl"
elifset_java_home;then
verbose"FallingbacktouseJavatodownload"
javaSource="$TMP_DOWNLOAD_DIR/Downloader.java"
targetZip="$TMP_DOWNLOAD_DIR/$distributionUrlName"
cat>"$javaSource"<<-END
	publicclassDownloaderextendsjava.net.Authenticator
	{
	protectedjava.net.PasswordAuthenticationgetPasswordAuthentication()
	{
	returnnewjava.net.PasswordAuthentication(System.getenv("MVNW_USERNAME"),System.getenv("MVNW_PASSWORD").toCharArray());
	}
	publicstaticvoidmain(String[]args)throwsException
	{
	setDefault(newDownloader());
	java.nio.file.Files.copy(java.net.URI.create(args[0]).toURL().openStream(),java.nio.file.Paths.get(args[1]).toAbsolutePath().normalize());
	}
	}
	END
#ForCygwin/MinGW,switchpathstoWindowsformatbeforerunningjavacandjava
verbose"-CompilingDownloader.java..."
"$(native_path"$JAVACCMD")""$(native_path"$javaSource")"||die"FailedtocompileDownloader.java"
verbose"-RunningDownloader.java..."
"$(native_path"$JAVACMD")"-cp"$(native_path"$TMP_DOWNLOAD_DIR")"Downloader"$distributionUrl""$(native_path"$targetZip")"
fi

#Ifspecified,validatetheSHA-256sumoftheMavendistributionzipfile
if[-n"${distributionSha256Sum-}"];then
distributionSha256Result=false
if["$MVN_CMD"=mvnd.sh];then
echo"Checksumvalidationisnotsupportedformaven-mvnd.">&2
echo"Pleasedisablevalidationbyremoving'distributionSha256Sum'fromyourmaven-wrapper.properties.">&2
exit1
elifcommand-vsha256sum>/dev/null;then
ifecho"$distributionSha256Sum$TMP_DOWNLOAD_DIR/$distributionUrlName"|sha256sum-c->/dev/null2>&1;then
distributionSha256Result=true
fi
elifcommand-vshasum>/dev/null;then
ifecho"$distributionSha256Sum$TMP_DOWNLOAD_DIR/$distributionUrlName"|shasum-a256-c>/dev/null2>&1;then
distributionSha256Result=true
fi
else
echo"Checksumvalidationwasrequestedbutneither'sha256sum'or'shasum'areavailable.">&2
echo"Pleaseinstalleithercommand,ordisablevalidationbyremoving'distributionSha256Sum'fromyourmaven-wrapper.properties.">&2
exit1
fi
if[$distributionSha256Result=false];then
echo"Error:FailedtovalidateMavendistributionSHA-256,yourMavendistributionmightbecompromised.">&2
echo"IfyouupdatedyourMavenversion,youneedtoupdatethespecifieddistributionSha256Sumproperty.">&2
exit1
fi
fi

#unzipandmove
ifcommand-vunzip>/dev/null;then
unzip${__MVNW_QUIET_UNZIP:+"$__MVNW_QUIET_UNZIP"}"$TMP_DOWNLOAD_DIR/$distributionUrlName"-d"$TMP_DOWNLOAD_DIR"||die"failedtounzip"
else
tarxzf${__MVNW_QUIET_TAR:+"$__MVNW_QUIET_TAR"}"$TMP_DOWNLOAD_DIR/$distributionUrlName"-C"$TMP_DOWNLOAD_DIR"||die"failedtountar"
fi

#Findtheactualextracteddirectoryname(handlessnapshotswherefilename!=directoryname)
actualDistributionDir=""

#Firsttrytheexpecteddirectoryname(forregulardistributions)
if[-d"$TMP_DOWNLOAD_DIR/$distributionUrlNameMain"];then
if[-f"$TMP_DOWNLOAD_DIR/$distributionUrlNameMain/bin/$MVN_CMD"];then
actualDistributionDir="$distributionUrlNameMain"
fi
fi

#Ifnotfound,searchforanydirectorywiththeMavenexecutable(forsnapshots)
if[-z"$actualDistributionDir"];then
#enableglobbingtoiterateoveritems
set+f
fordirin"$TMP_DOWNLOAD_DIR"/*;do
if[-d"$dir"];then
if[-f"$dir/bin/$MVN_CMD"];then
actualDistributionDir="$(basename"$dir")"
break
fi
fi
done
set-f
fi

if[-z"$actualDistributionDir"];then
verbose"Contentsof$TMP_DOWNLOAD_DIR:"
verbose"$(ls-la"$TMP_DOWNLOAD_DIR")"
die"CouldnotfindMavendistributiondirectoryinextractedarchive"
fi

verbose"FoundextractedMavendistributiondirectory:$actualDistributionDir"
printf%s\\n"$distributionUrl">"$TMP_DOWNLOAD_DIR/$actualDistributionDir/mvnw.url"
mv--"$TMP_DOWNLOAD_DIR/$actualDistributionDir""$MAVEN_HOME"||[-d"$MAVEN_HOME"]||die"failtomoveMAVEN_HOME"

clean||:
exec_maven"$@"
